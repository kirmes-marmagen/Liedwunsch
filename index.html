async function searchSongs(e) {
  if (e) e.preventDefault();

  const q = searchInput.value.trim();
  results.innerHTML = '';
  searchError.textContent = '';

  if (!q) {
    alert('Bitte gib erst einen Suchbegriff ein.');
    return;
  }

  try {
    const proxyUrl = new URL(ITUNES_PROXY_URL);
    proxyUrl.searchParams.set('term', q);
    proxyUrl.searchParams.set('country', 'DE');
    proxyUrl.searchParams.set('limit', '25');

    const response = await fetch(proxyUrl.toString(), {
      method: 'GET',
      headers: {
        "Authorization": "Bearer " + SUPABASE_ANON_KEY,
        "apikey": SUPABASE_ANON_KEY
      }
    });

    if (!response.ok) {
      const text = await response.text();
      console.error('Proxy-Fehler:', response.status, text);
      searchError.textContent = 'Apple-Suche ist aktuell nicht verf√ºgbar. Du kannst den Wunsch trotzdem unten ohne Treffer abschicken.';
      ensureManualWishButton();
      return;
    }

    const data = await response.json();
    console.log('Proxy-Daten:', data);

    if (!data.results || data.results.length === 0) {
      results.innerHTML = '<p class="muted">Keine Ergebnisse gefunden.</p>';
      ensureManualWishButton();
      return;
    }

    data.results.forEach(r => addResult(r));
    ensureManualWishButton();
  } catch (err) {
    console.error('Fehler bei der Suche:', err);
    searchError.textContent = 'Fehler bei der Suche. Du kannst den Wunsch trotzdem unten ohne Treffer abschicken.';
    ensureManualWishButton();
  }
}
